{% extends 'base.html' %}
{% load filtros %}

{% block content %}
{% if personagem.foto %}
  <div>
    <img src="{{ personagem.foto.url }}" alt="Foto de {{ personagem.nome }}" style="max-width:150px; max-height:150px;">
  </div>
{% endif %}
  <h1>Ficha de {{ personagem.nome }}</h1>

  <h2>Habilidades</h2>
  <ul>
    {% for campo in categorias.caracteristicas %}
      <li><strong>{{ campo|capfirst }}:</strong> {{ personagem|attr:campo }}</li>
    {% endfor %}
  </ul>
<h2>Vantagens</h2>
<ul>
  {% for vantagem in personagem.vantagens.all %}
    <li>
      <strong>{{ vantagem.nome }}</strong>
      {% if vantagem.descricao %} — {{ vantagem.descricao }}{% endif %}
    </li>
  {% empty %}
    <li>Nenhuma vantagem selecionada.</li>
  {% endfor %}
</ul>
  <h2>Defesas</h2>
  <ul>
    {% for campo in categorias.defesas %}
      <li><strong>{{ campo|capfirst }}:</strong> {{ personagem|attr:campo }}</li>
    {% endfor %}
  </ul>

  <h2>Perícias</h2>
  <ul>
    {% for campo in categorias.pericias %}
      <li><strong>{{ campo|capfirst }}:</strong> {{ personagem|attr:campo }}</li>
    {% endfor %}
  </ul>

  <h2>Poderes</h2>
<ul>
  {% for poder in personagem.poderes.all %}
    {% if not poder.de_item %}
      <li>
        <strong>{{ poder.nome }}</strong> — Bônus de Ataque: {{ poder.bonus_ataque }}, Nível do Efeito: {{ poder.nivel_efeito }}
      </li>
    {% endif %}
  {% empty %}
    <li>Nenhum poder adicionado.</li>
  {% endfor %}
</ul>

<h3>Poderes de Itens</h3>
<ul>
  {% if poderes_de_item %}
    {% for poder in poderes_de_item %}
      <li>
        <strong>{{ poder.nome }}</strong>
        {% if poder.item_origem %} ({{ poder.item_origem.nome }}){% endif %}
        — Bônus de Ataque: {{ poder.bonus_ataque }}, Nível do Efeito: {{ poder.nivel_efeito }}
      </li>
    {% endfor %}
  {% else %}
    <li>Nenhum poder de item.</li>
  {% endif %}
</ul>

<h2>Inventário</h2>
<p>Ouro: {{ personagem.inventario.ouro }}</p>
<p>Dragon shard: {{ personagem.inventario.dragon_shard }}</p>

<table border="1">
  <thead>
    <tr>
      <th>Nome</th>
      <th>Tipo</th>
      <th>Raridade</th>
      <th>Descrição</th>
      <th>Preço</th>
    </tr>
  </thead>
  <tbody>
    {% for item in personagem.inventario.itens.all %}
      <tr>
        <td>{{ item.nome }}</td>
        <td>{{ item.tipo }}</td>
        <td>{{ item.raridade }}</td>
        <td>{{ item.descricao }}</td>
        <td>{{ item.preco }}</td>
      </tr>
    {% empty %}
      <tr>
        <td colspan="5">Nenhum item no inventário.</td>
      </tr>
    {% endfor %}
  </tbody>
</table>

  <a href="{% url 'editar_personagem' personagem.id %}" class="btn btn-primary">Editar</a>
  <a href="{% url 'listar_personagens' %}" class="btn btn-secondary">Voltar</a>
{% endblock %}