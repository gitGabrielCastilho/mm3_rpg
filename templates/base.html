<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Mutantes & Malfeitores</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    nav {
      background-color: #eee;
      padding: 10px;
      border-radius: 5px;
    }
    nav a {
      margin-right: 15px;
      text-decoration: none;
      color: #333;
      font-weight: bold;
    }
    nav form {
      display: inline;
    }
    nav button {
      background: none;
      border: none;
      color: blue;
      cursor: pointer;
      font-weight: bold;
      text-decoration: underline;
    }
  </style>
</head>
<body>
<header style="margin-bottom: 10px;">
  {% if user.is_authenticated and user.perfilusuario.sala_atual %}
    <span style="background: #e0ffe0; padding: 6px 12px; border-radius: 6px; font-weight: bold; margin-right: 10px;">
      Sala atual: {{ user.perfilusuario.sala_atual.nome }} ({{ user.perfilusuario.sala_atual.codigo }})
    </span>
    <form method="post" action="{% url 'sair_sala' %}" style="display:inline; margin-right: 20px;">
      {% csrf_token %}
      <button type="submit" style="background: #ffdddd; color: #a00; border-radius: 4px; border: 1px solid #a00; padding: 4px 10px; font-weight: bold;">Sair da Sala</button>
    </form>
  {% endif %}
</header>
<nav>
  <a href="/">Home</a>
  {% if user.is_authenticated %}
    <a href="{% url 'listar_personagens' %}">Meus Personagens</a>
    <a href="{% url 'criar_personagem' %}">Criar Personagem</a>
    <a href="{% url 'itens' %}">Itens</a>
    <a href="{% url 'criar_sala' %}">Criar Sala</a>
    <a href="{% url 'listar_salas' %}">Minhas Salas</a>
    {% with perfil=user.perfilusuario %}
      {% if perfil.sala_atual %}
        {% if perfil.tipo == 'game_master' %}
          <a href="{% url 'criar_combate' perfil.sala_atual.id %}">Novo Combate</a>
          <a href="{% url 'listar_combates' perfil.sala_atual.id %}">Combates</a>
          <a href="{% url 'listar_mapas' %}">Meus Mapas</a>
          <a href="{% url 'adicionar_mapa_global' %}">Adicionar Mapa</a>
        {% endif %}
      {% endif %}
    {% endwith %}
    <form action="{% url 'logout' %}" method="post" style="display:inline;">
      {% csrf_token %}
      <button type="submit">Sair</button>
    </form>
  {% else %}
    <a href="{% url 'login' %}">Login</a>
    <a href="{% url 'cadastrar_usuario' %}">Cadastro</a>
  {% endif %}
</nav> 

<hr>
  {% if messages %}
  <ul>
    {% for message in messages %}
      <li style="color: green;">{{ message }}</li>
    {% endfor %}
  </ul>
{% endif %}
  {% block content %}{% endblock %}
</body>
</html>
