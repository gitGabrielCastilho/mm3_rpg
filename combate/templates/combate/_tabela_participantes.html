{# Template parcial para a tabela de participantes, reutilizável para AJAX #}
{% load filtros %}
<table id="tabela-participantes">
  <tr>
    <th>Foto</th>
    <th>Nome</th>
    <th>Dano</th>
    <th>Aflição</th>
    <th>Ferimentos</th>
    <th>Ficha</th>
  {% get_perfil as perfil %}
  {% if perfil and perfil.sala_atual and perfil.sala_atual.game_master == user %}
        <th>Remover</th>
      {% endif %}
  </tr>
  {% for p in participantes %}
    <tr>
      <td>
        {% if p.personagem.foto %}
          <img src="{{ p.personagem.foto.url }}" alt="Foto" style="max-width:60px; max-height:60px;">
        {% else %}
          <span>—</span>
        {% endif %}
      </td>
  <td>{{ p.display_nome|default:p.personagem.nome }}</td>
      <td>{{ p.dano }}</td>
      <td>{{ p.aflicao }}</td>
      <td>{{ p.ferimentos|default:0 }}</td>
      <td>
        {% if p.personagem.usuario == user %}
          <a href="{% url 'ficha_personagem' p.personagem.id %}" target="_blank" class="btn-link-ficha">Ver Ficha</a>
        {% endif %}
      </td>
  {% if perfil and perfil.sala_atual and perfil.sala_atual.game_master == user %}
          <td>
            <form method="post" action="{% url 'remover_participante' combate.id p.id %}" class="form-remover-participante">
              {% csrf_token %}
              <button type="submit" class="btn-remover-participante">Remover</button>
            </form>
          </td>
        {% endif %}
    </tr>
  {% endfor %}
</table>
